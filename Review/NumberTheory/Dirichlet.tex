\section{狄利克雷卷积，狄利克雷逆与莫比乌斯反演}
\subsection{狄利克雷卷积}
\index{D!Dirichlet Convolution}
对于数论函数$f,g$，定义狄利克雷卷积
\begin{displaymath}
	(f*g)(n)=\sum_{d|n}{f(d)g(\frac{n}{d})}=\sum_{ab=n}{f(a)g(b)}
\end{displaymath}
由积性函数集合与狄利克雷卷积组成的群的乘法单位元为元函数$\epsilon$。

狄利克雷卷积有如下性质：
\begin{eqnarray*}
	\textrm{结合律} & (f*g)*h=f*(g*h)\\
	\textrm{分配律} & f*(g+h)=f*g+f*h\\
	\textrm{交换律} & f*g=g*f；\\
	\textrm{单位元} & f*\epsilon=\epsilon*f=f。
\end{eqnarray*}
\subsection{狄利克雷逆}
\index{D!Dirichlet Inverse}
已知数论函数$f$，求$g=f^{-1}$，满足$f*g=\epsilon$。
\begin{itemize}
	\item 当$n=1$时，有$(f*g)(1)=f(1)g(1)=\epsilon(1)=1$，
	      解得$g(1)=\frac{1}{f(1)}$。
	\item 当$n>1$时，
	      有$\displaystyle (f*g)(n)=\sum_{ab=n}{f(a)g(b)}=\epsilon(n)=0$，
		解得
		\begin{displaymath}
		g(n)=\frac{-1}{f(1)}\sum_{d|n,d<n}{f(\frac{n}{d})g(d)}
		\end{displaymath}
\end{itemize}
\subsubsection{狄利克雷逆性质}
\begin{property}
	积性函数的狄利克雷逆仍然是积性函数。
\end{property}
\begin{property}
	若数论函数$f,g$为积性函数，则$(f*g)^{-1}=f^{-1}*g^{-1}$。
\end{property}
\begin{property}\label{CMFP}
	积性函数$f$为完全积性函数当且仅当$f^{-1}(n)=\mu(n)f(n)$。
\end{property}
\subsubsection{常见数论函数及其狄利克雷逆}
\begin{itemize}
	\item $1*\mu=\epsilon$\\
	      参见定理~\ref{MobiusT}的证明。
	\item $id^\alpha*(\mu\cdot id^\alpha)=\epsilon$\\
	      根据性质~\ref{CMFP}可证明。
	\item $\displaystyle \varphi*(\sum_{d|n}{\mu(d)d})=\epsilon$\\
	      由定理~\ref{PhiT}可得$id=\varphi*1$，两边同时乘上$\mu$
	      可得$id*\mu=\varphi$，所以$\varphi^{-1}=id^{-1}*\mu^{-1}=id^{-1}*1$。
	\item $\sigma_\alpha*(\sum_{d|n}{\mu(d)\mu(\frac{n}{d})d^\alpha})=\epsilon$

	      $\sigma_\alpha=id^\alpha*1$可推出
	      $(\sigma_\alpha)^{-1}=(id^\alpha)^{-1}*\mu$
\end{itemize}
以上内容参考了Wikipedia-EN\footnote{Dirichlet convolution - Wikipedia\\
	\url{https://en.wikipedia.org/wiki/Dirichlet\_convolution}}。
\subsection{莫比乌斯反演}
\index{M!Möbius Inversion}
\begin{theorem}
	对于数论函数$f,g$，满足$\displaystyle g(n)=\sum_{d|n}f(d)$，则有
	\begin{displaymath}
		f(n)=\sum_{d|n}\mu(d)g(\frac{n}{d})
	\end{displaymath}
\end{theorem}
莫比乌斯反演可表示为若$g=f*1$则$f=\mu*g$。
证明：将$g=f*1$两边同时乘上$\mu$可证。
证明源自Wikipedia-EN\footnote{Möbius inversion formula - Wikipedia\\
	\url{https://en.wikipedia.org/wiki/Mobius_inversion}}。
\subsection{常见技巧}
\begin{itemize}
	\item
	      对于数论函数$g,f$，
	      \begin{displaymath}
		      g(n)=\sum_{n|d}{f(d)}\Rightarrow
		      f(n)=\sum_{n|d}{\mu(d)g(\frac{d}{n})}
	      \end{displaymath}
	\item
	      若$\displaystyle n=\prod_{i=1}^m{{p_i}^{c_i}},g(n)=\sum_{d|n}{f(d)}$
	      且$f$为积性函数，将$g$看做$f*1$可知$g$也是积性函数，则$\displaystyle
		      g(n)=\prod_{i=1}^m{\sum_{j=0}^{c_i}{f(p_i^j)}}$。
	\item 交换内外求和顺序。
	\item 枚举倍数、因子、最大公约数等有共性的值并换元。
	\item 在化简前缀和函数时可能会遇到如下式子：
	      \begin{eqnarray*}
		      ans(n)&=&\sum_{i=1}^n{f(i)}\\
		      &=&A(n)+B(n)\sum_{i=1}^n{\sum_{d|i}{f(d)}}\\
		      &=&A(n)+B(n)\sum_{\frac{i}{d}=1}^n{\sum_{j=1}^{\left[\frac{n}{\frac{i}{d}}\right]}{f(j)}}\\
		      &=&A(n)+B(n)\sum_{t=1}^n{\sum_{j=1}^{[\frac{n}{t}]}{f(j)}}\\
		      &=&A(n)+B(n)\sum_{t=1}^n{ans([\frac{n}{t}])}
	      \end{eqnarray*}
	      线性筛预处理一部分前缀和（一般预处理规模为$n^{2/3}$，最终时间复杂度
	      $O(n^{2/3})$，大规模前缀和使用根号分块法递归计算。

	      注意这里可以使用存储Trick来Cache计算结果（多次询问使用map或时间戳数组
	      清零，下面只讨论单次询问的情况）。设预处理了前$k$个前缀和，其中$k\geq \sqrt{n}$。
		那么$[\frac{n}{t}]>k$的值不超过$\sqrt{n}$个，并且$t$不同对应的$[\frac{n}{t}]$值也不同。
		所以可以以$t$为下标把计算结果存入另一个数组中。
	\item 同时除以最大公约数使其互质，然后套用$\varphi$。
	\item $\displaystyle [gcd(i,j)=1]=\sum_{k|gcd(i,j)}\mu(k)=\sum_{k|i,k|j}\mu(k)$
	\item $\displaystyle gcd(i,j)=\sum_{k|gcd(i,j)}{\varphi(k)}=\sum_{d=1}^{min(i,j)}{\varphi(d)[\frac{i}{d}][\frac{j}{d}]}$

		遇到该式时不要枚举gcd值将其转换为上一个式子，从而陷入更复杂的化简。

	\item $\displaystyle \sum_{i=1}^n{i}=
		      \sum_{i=1}^n{\sum_{d|i}\varphi(d)}=
		      \sum_{d=1}^n{\varphi(d)\cdot[\frac{n}{d}]}$
	\item $(id\cdot\varphi)*id=id^2$
	\item 「CQOI2015」选数：

	将$[L,H]$内的$K$的倍数除以$K$得到区间$[l,r]$，
	记$G_i$为$[l,r]$中$i$的倍数个数，使用前文所述技巧推出答案为
	$\displaystyle \sum_{d=1}^r{\mu(d)G_d^n}$。但是$r$仍然是$1e9$级别的，
	可以考虑整除分块枚举相同的$G_d$再使用杜教筛求$\mu$的前缀和解决。

	注意这里还有个条件$H-L\leq 1e5$，infinity\_edge的博客\footnote{
		「BZOJ3930」「CQOI2015」选数\\
		\url{https://blog.csdn.net/infinity\_edge/article/details/78829630}
	}中提到存在一个性质：
	{\bfseries 若所有数字不全相同，则数字的极差不小于它们的最大公约数。}

	接下来只处理数字不全相同的情况，由于选取的数在$[l,r]$内，因此只需枚举到
	$r-l$，同时选取方案要扣除数字全相同的情况，即$G_d^n-G_d$。这种讨论还有个
	例外：数字全为$1$时是可行解，最后需要特判$l$是否为1。时间复杂度
	$O((r-l)+\sqrt{r-l}\lg N)$。

	\item 「LibreOJ β Round \#4」求和：

	$\displaystyle \sum_{d|n}{\mu^2(d)\mu(\frac{n}{d})}$当且仅当$n$
	为完全平方数时值为$\mu(\sqrt{n})$，其余情况为0。

	证明：考虑$n$的质因数分解，若存在质因数幂次$>2$，则必有一个$\mu$值为0，该式的值为0；
	若存在质因数幂次为1，不考虑其它质因数是否使$\mu$为0，$\mu(\frac{n}{d})$项必然抵消。

	综上所述，$n$为完全平方数时才有贡献。
	\item $\mu(ab)=\mu(a)\mu(b)[(a,b)=1]$

	证明：当$(a,b)\neq 1$时，$ab$有平方因子，值为0。否则根据积性函数的性质，
	$\mu(ab)=\mu(a)\mu(b)$。
\end{itemize}
更多技巧待补充。
